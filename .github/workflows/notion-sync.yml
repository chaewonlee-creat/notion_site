name: Manual Notion → Markdown

on:
  workflow_dispatch:   # ⬅︎ “Run workflow” 버튼으로만 실행

jobs:
  build_md:
    runs-on: ubuntu-latest

    steps:
    # ① 리포지토리 Read-only 체크아웃 (GITHUB_TOKEN이면 충분)
    - uses: actions/checkout@v4

    # ② Node 설치
    - uses: actions/setup-node@v4
      with:
        node-version: 20

    - name: Install deps
      run: npm ci

    # ③ Notion 비밀 주입
    - name: Create .env.local
      run: |
        cat > .env.local <<'EOF'
        NOTION_SECRET=${{ secrets.NOTION_SECRET }}
        NOTION_DATABASE_ID=${{ secrets.NOTION_DATABASE_ID }}
        EOF

    # ④ 변환 실행 (스크립트는 src/content 아래에 md 파일 생성)
    - name: Run conversion script
      run: npm run sync:notion

    # ⑤ (선택) 변환된 md를 artefact로 업로드
    - name: Upload markdown as artefact
      uses: actions/upload-artifact@v4
      with:
        name: notion-md
        path: src/content/*.md
